
$ ./virtualbox-appliance.shell --instance="devops-console" \
                               --account="devops" \
                               --secret="~/.secrets/devops.secret" \
                               --create \
                               --deploy \
                               --iso-file="~/Downloads/ubuntu-22.04.1-desktop-amd64.iso" \
                               --patch \
                               --provision \
                               --ssh-key="~/.ssh/devnetops.pub" \
                               --start \
;

Creating Medium (Hard Drive: *.vdi)

0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Medium created. UUID: f37205f9-1a3b-4576-8439-fb644b3940d0

Generating VirtualBox Un-Attended Installation

VBoxManage: info: Preparing unattended installation of Ubuntu22_LTS_64 in machine 'devops-console' (70723acc-1d93-491c-a655-57d2636c66dc).
VBoxManage: info: Using values:
                           isoPath = /Users/emvaldes/Downloads/ubuntu-22.04.1-desktop-amd64.iso
                              user = devops
                          password = devops
                      fullUserName = DevOps Engineer
                        productKey =
                  additionsIsoPath = /Applications/VirtualBox.app/Contents/MacOS/VBoxGuestAdditions.iso
             installGuestAdditions = true
              validationKitIsoPath =
            installTestExecService = false
                            locale = en_US
                           country = US
                          timeZone = utc
                             proxy =
                          hostname = devops-console.local
       packageSelectionAdjustments =
                 auxiliaryBasePath = /Users/emvaldes/.virtualization/virtualbox/devops-console/Unattended-70723acc-1d93-491c-a655-57d2636c66dc-
                        imageIndex = 1
                scriptTemplatePath = /Applications/VirtualBox.app/Contents/MacOS/UnattendedTemplates/ubuntu_preseed.cfg
     postInstallScriptTemplatePath = /Applications/VirtualBox.app/Contents/MacOS/UnattendedTemplates/debian_postinstall.sh
                postInstallCommand =
      extraInstallKernelParameters =  auto=true preseed/file=/cdrom/preseed.cfg priority=critical quiet splash noprompt noshell automatic-ubiquity debian-installer/locale=en_US keyboard-configuration/layoutcode=us languagechooser/language-name=English localechooser/supported-locales=en_US.UTF-8 countrychooser/shortlist=US --
                          language = en
                  detectedOSTypeId = Ubuntu_64
                 detectedOSVersion = 22.04.1 LTS "Jammy Jellyfish"
                  detectedOSFlavor = Ubuntu
               detectedOSLanguages = en-US
                   detectedOSHints =
VBoxManage: info: VM 'devops-console' (70723acc-1d93-491c-a655-57d2636c66dc) is ready to be started (e.g. VBoxManage startvm).

Notice: Listing modifications (patch-preseed.cfg)

# Users
d-i passwd/user-fullname string DevOps Engineer
d-i passwd/username string ***
d-i passwd/user-password password ***
d-i passwd/user-password-again password ***
d-i passwd/root-login boolean true
d-i passwd/root-password password ***
d-i passwd/root-password-again password ***
d-i user-setup/allow-password-weak boolean true
d-i passwd/user-default-groups string sudo

# Grub

patching file '/Users/emvaldes/.virtualization/virtualbox/devops-console/Unattended-70723acc-1d93-491c-a655-57d2636c66dc-vboxpostinstall.sh'

Notice: Listing modifications (patch-vboxpostinstall.sh)

## emvaldes@hotmail.com
log_command_in_target apt-get install curl --yes;
log_command_in_target apt-get install git --yes;
log_command_in_target apt-get install jq --yes;
log_command_in_target apt-get install python-is-python3 --yes;

## emvaldes@hotmail.com
log_command_in_target apt-get install openssh-server --yes;
log_command_in_target systemctl enable ssh  ## 2>/dev/null;
log_command_in_target systemctl status ssh  ## 2>/dev/null;

#
# GAs
#

echo "--------------------------------------------------" >> "${MY_LOGFILE}"
echo '** Installing VirtualBox Guest Additions...' | tee -a "${MY_LOGFILE}"
MY_IGNORE_EXITCODE=2  # returned if modules already loaded and reboot required.
log_command_in_target /bin/bash "${MY_CHROOT_CDROM}/vboxadditions/VBoxLinuxAdditions.run" --nox11
log_command_in_target /bin/bash -c "udevadm control --reload-rules" # GAs doesn't yet do this.
log_command_in_target /bin/bash -c "udevadm trigger"                 # (ditto)
MY_IGNORE_EXITCODE=
log_command_in_target usermod -a -G vboxsf "devops"

## emvaldes@hotmail.com
log_command_in_target usermod -a -G sudo "devops"

./patch-preseed.cfg -> ./Unattended-70723acc-1d93-491c-a655-57d2636c66dc-preseed.cfg
./patch-vboxpostinstall.sh -> ./Unattended-70723acc-1d93-491c-a655-57d2636c66dc-vboxpostinstall.sh

Warning: Removing patched-file duplicates (e.g.: *.orig) ...

./Unattended-70723acc-1d93-491c-a655-57d2636c66dc-vboxpostinstall.sh.orig

Waiting for VM "devops-console" to power on...
VM "devops-console" has been successfully started.
